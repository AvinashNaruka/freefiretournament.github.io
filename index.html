<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Free Fire Tournament Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body { background: linear-gradient(135deg,#0f2027,#203a43,#2c5364); color:#fff; font-family: Arial, sans-serif; }
    .container{ width:90%; margin:auto; padding:20px;}
    h2{ color:#00e6e6; }
    .card{ background:#111; padding:15px; margin:10px 0; border-radius:8px; }
    button{ padding:6px 12px; margin:4px; border:none; border-radius:5px; cursor:pointer; }
    .approve{ background:green; color:#fff; }
    .reject{ background:red; color:#fff; }
  </style>
</head>
<body>
<div class="container">

  <h2>Free Fire Tournament</h2>

  <!-- Auth -->
  <div id="authSection">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="signup()">Sign Up</button>
    <button onclick="login()">Login</button>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- User Section -->
  <div id="userSection" style="display:none;">
    <h2>My Registrations</h2>
    <div id="myRegistrations"></div>
  </div>

  <!-- Admin Section -->
  <div id="adminSection" style="display:none;">
    <h2>Admin — Registrations</h2>
    <select id="tournamentSelect"></select>
    <div id="adminRegistrations"></div>
  </div>

</div>

<script>
  // --- Firebase Config ---
  const firebaseConfig = {
    apiKey: "AIzaSyCAjiInmaJsHSqhlxZZ0heIdNEMu6m6Y6Y",
    authDomain: "freefire-tournament-2009.firebaseapp.com",
    projectId: "freefire-tournament-2009",
    storageBucket: "freefire-tournament-2009.firebasestorage.app",
    messagingSenderId: "498357283098",
    appId: "1:498357283098:web:2f05123efe6c57e65524a3"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // --- Signup ---
  function signup(){
    const email=document.getElementById('email').value;
    const password=document.getElementById('password').value;
    auth.createUserWithEmailAndPassword(email,password)
    .then(()=>alert("Signup successful")).catch(e=>alert(e.message));
  }

  // --- Login ---
  function login(){
    const email=document.getElementById('email').value;
    const password=document.getElementById('password').value;
    auth.signInWithEmailAndPassword(email,password)
    .then(()=>alert("Login successful")).catch(e=>alert(e.message));
  }

  // --- Logout ---
  function logout(){ auth.signOut(); }

  // --- Auth State Change ---
  auth.onAuthStateChanged(user=>{
    if(user){
      document.getElementById("authSection").style.display="none";
      if(user.email==="avinashnaruka89@gmail.com"){ 
        loadAdmin(); 
        document.getElementById("adminSection").style.display="block";
        document.getElementById("userSection").style.display="none";
      } else {
        loadUser(user.uid); 
        document.getElementById("userSection").style.display="block";
        document.getElementById("adminSection").style.display="none";
      }
    } else {
      document.getElementById("authSection").style.display="block";
      document.getElementById("userSection").style.display="none";
      document.getElementById("adminSection").style.display="none";
    }
  });

  // --- Load User Registrations ---
  function loadUser(uid){
    db.collection("registrations").where("userId","==",uid)
    .onSnapshot(snap=>{
      let html="";
      snap.forEach(doc=>{
        let r=doc.data();
        html+=`<div class="card">
                 <p><b>Tournament:</b> ${r.tournamentName}</p>
                 <p><b>Status:</b> ${r.status||"Pending"}</p>
                 <p><b>UTR:</b> ${r.utr||"-"}</p>
               </div>`;
      });
      document.getElementById("myRegistrations").innerHTML=html||"No registrations yet.";
    });
  }

  // --- Load Admin Tournaments ---
  function loadAdmin(){
    db.collection("tournaments").onSnapshot(snap=>{
      let select=document.getElementById("tournamentSelect");
      select.innerHTML="";
      snap.forEach(doc=>{
        let t=doc.data();
        let opt=document.createElement("option");
        opt.value=doc.id;
        opt.text=`${t.name} — ${new Date(t.date).toLocaleString()}`;
        select.appendChild(opt);
      });
      if(select.value) loadRegistrations(select.value);
      select.onchange=()=>loadRegistrations(select.value);
    });
  }

  // --- Load Registrations for Tournament ---
  function loadRegistrations(tid){
    db.collection("registrations").where("tournamentId","==",tid)
    .onSnapshot(snap=>{
      let html="";
      snap.forEach(doc=>{
        let r=doc.data();
        html+=`<div class="card">
                 <p><b>Name:</b> ${r.playerName||"-"}</p>
                 <p><b>FF IDs:</b> ${r.ffIds||"-"}</p>
                 <p><b>WhatsApp:</b> ${r.whatsapp||"-"}</p>
                 <p><b>UTR:</b> ${r.utr||"-"}</p>
                 <p><b>Status:</b> ${r.status||"Pending"}</p>
                 <button class="approve" onclick="updateStatus('${doc.id}','Approved')">Approve</button>
                 <button class="reject" onclick="updateStatus('${doc.id}','Rejected')">Reject</button>
               </div>`;
      });
      document.getElementById("adminRegistrations").innerHTML=html||"No registrations yet.";
    });
  }

  // --- Update Status ---
  function updateStatus(id,status){
    db.collection("registrations").doc(id).update({status:status});
  }
</script>
</body>
</html>

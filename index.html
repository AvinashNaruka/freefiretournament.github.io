<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FreeFire Tournament Login Demo</title>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCAjiInmaJsHSqhlxZZ0heIdNEMu6m6Y6Y",
    authDomain: "freefire-tournament-2009.firebaseapp.com",
    projectId: "freefire-tournament-2009",
    storageBucket: "freefire-tournament-2009.appspot.com",
    messagingSenderId: "498357283098",
    appId: "1:498357283098:web:2f05123efe6c57e65524a3"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const adminEmail = "avinashnaruka89@gmail.com";

  // Elements
  let loginDiv, userDiv, adminDiv, signupDiv, messageDiv;

  window.onload = () => {
    loginDiv = document.getElementById("loginDiv");
    signupDiv = document.getElementById("signupDiv");
    userDiv = document.getElementById("userDiv");
    adminDiv = document.getElementById("adminDiv");
    messageDiv = document.getElementById("message");

    // Show login/signup initially
    showLogin();

    // Auth state observer
    onAuthStateChanged(auth, user => {
      if (user) {
        // logged in
        if (user.email === adminEmail) {
          showAdmin(user);
        } else {
          showUser(user);
        }
      } else {
        // logged out
        showLogin();
      }
    });
  };

  function showLogin() {
    loginDiv.style.display = "block";
    signupDiv.style.display = "block";
    userDiv.style.display = "none";
    adminDiv.style.display = "none";
    messageDiv.textContent = "";
  }

  function showUser(user) {
    loginDiv.style.display = "none";
    signupDiv.style.display = "none";
    userDiv.style.display = "block";
    adminDiv.style.display = "none";
    messageDiv.textContent = `Welcome, ${user.email}`;
  }

  function showAdmin(user) {
    loginDiv.style.display = "none";
    signupDiv.style.display = "none";
    userDiv.style.display = "none";
    adminDiv.style.display = "block";
    messageDiv.textContent = `Welcome Admin, ${user.email}`;
  }

  window.login = async () => {
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPass").value;
    try {
      await signInWithEmailAndPassword(auth, email, password);
      messageDiv.textContent = "Logged in!";
    } catch (e) {
      messageDiv.textContent = "Login failed: " + e.message;
    }
  };

  window.signup = async () => {
    const email = document.getElementById("signupEmail").value;
    const password = document.getElementById("signupPass").value;
    try {
      await createUserWithEmailAndPassword(auth, email, password);
      messageDiv.textContent = "Account created! Please login.";
    } catch (e) {
      messageDiv.textContent = "Signup failed: " + e.message;
    }
  };

  window.logout = async () => {
    await signOut(auth);
    messageDiv.textContent = "Logged out.";
  };

  // Example admin function to create tournament
  window.createTournament = async () => {
    const name = document.getElementById("tName").value;
    const date = document.getElementById("tDate").value;
    const fee = Number(document.getElementById("tFee").value);
    const slots = Number(document.getElementById("tSlots").value);
    if (!name || !date || !fee || !slots) {
      alert("Fill all fields!");
      return;
    }
    try {
      await addDoc(collection(db, "tournaments"), { name, date, fee, slots });
      alert("Tournament created!");
    } catch (e) {
      alert("Error: " + e.message);
    }
  };
</script>
<style>
  #loginDiv, #signupDiv, #userDiv, #adminDiv { margin: 20px; }
  #message { margin: 10px; font-weight: bold; }
</style>
</head>
<body>

<div id="loginDiv">
  <h2>Login</h2>
  <input id="loginEmail" type="email" placeholder="Email" /><br />
  <input id="loginPass" type="password" placeholder="Password" /><br />
  <button onclick="login()">Login</button>
</div>

<div id="signupDiv">
  <h2>Sign Up</h2>
  <input id="signupEmail" type="email" placeholder="Email" /><br />
  <input id="signupPass" type="password" placeholder="Password" /><br />
  <button onclick="signup()">Create Account</button>
</div>

<div id="userDiv" style="display:none;">
  <h2>User Dashboard</h2>
  <button onclick="logout()">Logout</button>
  <p>Yahan user apni registered tournaments dekh sakta hai (abhi demo me nahi hai)</p>
</div>

<div id="adminDiv" style="display:none;">
  <h2>Admin Dashboard</h2>
  <button onclick="logout()">Logout</button>
  <h3>Create Tournament</h3>
  <input id="tName" placeholder="Tournament Name" /><br />
  <input id="tDate" type="datetime-local" /><br />
  <input id="tFee" type="number" placeholder="Entry Fee" /><br />
  <input id="tSlots" type="number" placeholder="Slots" /><br />
  <button onclick="createTournament()">Create Tournament</button>
</div>

<div id="message"></div>

</body>
</html>
